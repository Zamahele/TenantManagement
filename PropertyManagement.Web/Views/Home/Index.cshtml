@using PropertyManagement.Web.ViewModels
@model DashboardViewModel
@{
  ViewData["Title"] = "Dashboard";
}
<link rel="stylesheet" href="~/css/dashboard.css" asp-append-version="true" />

<!-- Page Header -->
<div class="page-header mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <div class="page-title">
      <h1 class="page-title-main">Dashboard</h1>
      <p class="page-title-sub text-secondary mb-0">Property portfolio overview and key performance metrics</p>
    </div>
    <div class="page-actions">
      <div class="page-info text-end">
        <div class="text-secondary small">Last Updated</div>
        <div class="fw-semibold">@DateTime.Now.ToString("MMM dd, yyyy HH:mm")</div>
      </div>
    </div>
  </div>
</div>
  <!-- Key Performance Indicators -->
  <div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
      <div class="kpi-card gradient-primary">
        <div class="kpi-content">
          <div class="kpi-icon">
            <i class="bi bi-speedometer2"></i>
          </div>
          <div class="kpi-text">
            <h3 class="kpi-value">@Model.OccupancyRate.ToString("F1")%</h3>
            <p class="kpi-label">Occupancy Rate</p>
            <div class="kpi-trend text-success small">
              <i class="bi bi-arrow-up"></i> Good performance
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="kpi-card gradient-success">
        <div class="kpi-content">
          <div class="kpi-icon">
            <i class="bi bi-currency-dollar"></i>
          </div>
          <div class="kpi-text">
            <h3 class="kpi-value">@Model.CollectionRate.ToString("F1")%</h3>
            <p class="kpi-label">Collection Rate</p>
            <div class="kpi-trend text-success small">
              <i class="bi bi-arrow-up"></i> @Model.CollectedRent.ToString("C") collected
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="kpi-card gradient-warning">
        <div class="kpi-content">
          <div class="kpi-icon">
            <i class="bi bi-tools"></i>
          </div>
          <div class="kpi-text">
            <h3 class="kpi-value">@Model.MaintenanceResponseRate.ToString("F1")%</h3>
            <p class="kpi-label">Maintenance Response</p>
            <div class="kpi-trend text-warning small">
              <i class="bi bi-clock"></i> @Model.PendingRequests pending
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="kpi-card gradient-info">
        <div class="kpi-content">
          <div class="kpi-icon">
            <i class="bi bi-graph-up"></i>
          </div>
          <div class="kpi-text">
            <h3 class="kpi-value">@Model.TotalMonthlyRent.ToString("C0")</h3>
            <p class="kpi-label">Monthly Revenue</p>
            <div class="kpi-trend text-info small">
              <i class="bi bi-info-circle"></i> @Model.OutstandingRent.ToString("C") outstanding
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Property Overview Cards -->
  <div class="row g-4 mb-4">
    <div class="col-xl-2 col-md-4 col-6">
      <div class="property-card">
        <div class="property-icon bg-primary">
          <i class="bi bi-door-closed"></i>
        </div>
        <div class="property-info">
          <h4 class="property-value">@Model.TotalRooms</h4>
          <p class="property-label">Total Rooms</p>
        </div>
      </div>
    </div>
    
    <div class="col-xl-2 col-md-4 col-6">
      <div class="property-card">
        <div class="property-icon bg-success">
          <i class="bi bi-check-circle"></i>
        </div>
        <div class="property-info">
          <h4 class="property-value">@Model.AvailableRooms</h4>
          <p class="property-label">Available</p>
        </div>
      </div>
    </div>
    
    <div class="col-xl-2 col-md-4 col-6">
      <div class="property-card">
        <div class="property-icon bg-info">
          <i class="bi bi-house-lock"></i>
        </div>
        <div class="property-info">
          <h4 class="property-value">@Model.OccupiedRooms</h4>
          <p class="property-label">Occupied</p>
        </div>
      </div>
    </div>
    
    <div class="col-xl-2 col-md-4 col-6">
      <div class="property-card">
        <div class="property-icon bg-warning">
          <i class="bi bi-wrench-adjustable"></i>
        </div>
        <div class="property-info">
          <h4 class="property-value">@Model.UnderMaintenanceRooms</h4>
          <p class="property-label">Maintenance</p>
        </div>
      </div>
    </div>
    
    <div class="col-xl-2 col-md-4 col-6">
      <div class="property-card">
        <div class="property-icon bg-secondary">
          <i class="bi bi-people"></i>
        </div>
        <div class="property-info">
          <h4 class="property-value">@Model.TotalTenants</h4>
          <p class="property-label">Tenants</p>
        </div>
      </div>
    </div>
    
    <div class="col-xl-2 col-md-4 col-6">
      <div class="property-card">
        <div class="property-icon bg-dark">
          <i class="bi bi-file-earmark-text"></i>
        </div>
        <div class="property-info">
          <h4 class="property-value">@Model.ActiveLeases</h4>
          <p class="property-label">Active Leases</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Analytics & Alerts Row -->
  <div class="row g-4 mb-4">
    <div class="col-xl-8">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">
            <i class="bi bi-bar-chart-line me-2 text-primary"></i>Property Analytics
          </h5>
          <small class="text-muted">Current month overview</small>
        </div>
        <div class="card-body">
          <div class="row g-4">
            <!-- Charts Row -->
            <div class="col-md-6">
              <div class="chart-container">
                <h6 class="text-muted mb-3">Room Status Distribution</h6>
                <canvas id="roomStatusChart" style="height: 250px;"></canvas>
              </div>
            </div>
            <div class="col-md-6">
              <div class="chart-container">
                <h6 class="text-muted mb-3">Financial Overview</h6>
                <canvas id="financialChart" style="height: 250px;"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Alerts & Notifications -->
    <div class="col-xl-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">
            <i class="bi bi-bell me-2 text-warning"></i>Alerts & Notifications
          </h5>
          <span class="badge bg-danger">@Model.Alerts.Count</span>
        </div>
        <div class="card-body p-0">
          @if (Model.Alerts.Any())
          {
            <div class="alert-list">
              @foreach (var alert in Model.Alerts)
              {
                <div class="alert-item alert-@alert.Type">
                  <div class="alert-icon">
                    <i class="@alert.Icon"></i>
                  </div>
                  <div class="alert-content">
                    <h6 class="alert-title">@alert.Title</h6>
                    <p class="alert-message">@alert.Message</p>
                    <small class="text-muted">@alert.CreatedAt.ToString("MMM dd, yyyy")</small>
                  </div>
                  @if (!string.IsNullOrEmpty(alert.Url))
                  {
                    <div class="alert-action">
                      <a href="@alert.Url" class="btn btn-sm btn-outline-@alert.Type">View</a>
                    </div>
                  }
                </div>
              }
            </div>
          }
          else
          {
            <div class="p-4 text-center text-muted">
              <i class="bi bi-check-circle fs-1 mb-2 text-success"></i>
              <p class="mb-0">All systems running smoothly!</p>
              <small>No alerts at this time</small>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
  
  <!-- Recent Activity & Quick Actions -->
  <div class="row g-4 mb-4">
    <!-- Recent Activity -->
    <div class="col-xl-7">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">
            <i class="bi bi-activity me-2 text-info"></i>Recent Activity
          </h5>
          <small class="text-muted">Last 7 days</small>
        </div>
        <div class="card-body p-0">
          @if (Model.RecentActivities.Any())
          {
            <div class="activity-list">
              @foreach (var activity in Model.RecentActivities)
              {
                <div class="activity-item">
                  <div class="activity-icon bg-light">
                    <i class="@activity.Icon text-primary"></i>
                  </div>
                  <div class="activity-content">
                    <p class="activity-description">@activity.Description</p>
                    <small class="text-muted">@activity.Timestamp.ToString("MMM dd, yyyy HH:mm")</small>
                  </div>
                  @if (!string.IsNullOrEmpty(activity.Url))
                  {
                    <div class="activity-action">
                      <a href="@activity.Url" class="btn btn-sm btn-outline-secondary">View</a>
                    </div>
                  }
                </div>
              }
            </div>
          }
          else
          {
            <div class="p-4 text-center text-muted">
              <i class="bi bi-clock-history fs-1 mb-2"></i>
              <p class="mb-0">No recent activity</p>
              <small>Activity will appear here once operations begin</small>
            </div>
          }
        </div>
      </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="col-xl-5">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white">
          <h5 class="card-title mb-0">
            <i class="bi bi-lightning me-2 text-warning"></i>Quick Actions
          </h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            @foreach (var action in Model.QuickActions)
            {
              <div class="col-md-6">
                <a href="@action.Url" class="quick-action-card text-decoration-none">
                  <div class="quick-action-content">
                    <div class="quick-action-icon bg-@action.Color">
                      <i class="@action.Icon"></i>
                    </div>
                    <div class="quick-action-text">
                      <h6 class="quick-action-title">@action.Title</h6>
                      <small class="text-muted">@action.Description</small>
                    </div>
                  </div>
                </a>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Operational Metrics -->
  <div class="row g-4">
    <div class="col-xl-3 col-md-6">
      <div class="metric-card bg-gradient-primary">
        <div class="metric-icon">
          <i class="bi bi-calendar-check"></i>
        </div>
        <div class="metric-content">
          <h3 class="metric-value text-white">@Model.MaintenanceRequestsToday</h3>
          <p class="metric-label text-white-50">Maintenance Today</p>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="metric-card bg-gradient-success">
        <div class="metric-icon">
          <i class="bi bi-search"></i>
        </div>
        <div class="metric-content">
          <h3 class="metric-value text-white">@Model.InspectionsDueThisWeek</h3>
          <p class="metric-label text-white-50">Inspections This Week</p>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="metric-card bg-gradient-warning">
        <div class="metric-icon">
          <i class="bi bi-calendar-plus"></i>
        </div>
        <div class="metric-content">
          <h3 class="metric-value text-white">@Model.NewBookingsThisWeek</h3>
          <p class="metric-label text-white-50">New Bookings</p>
        </div>
      </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
      <div class="metric-card bg-gradient-info">
        <div class="metric-icon">
          <i class="bi bi-exclamation-triangle"></i>
        </div>
        <div class="metric-content">
          <h3 class="metric-value text-white">@Model.TenantsWithOutstandingBalance</h3>
          <p class="metric-label text-white-50">Outstanding Balances</p>
        </div>
      </div>
    </div>
  </div>
</div>

@section Scripts {
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Professional Room Status Doughnut Chart
    new Chart(document.getElementById('roomStatusChart'), {
        type: 'doughnut',
        data: {
            labels: ['Available', 'Occupied', 'Under Maintenance'],
            datasets: [{
                data: [@Model.AvailableRooms, @Model.OccupiedRooms, @Model.UnderMaintenanceRooms],
                backgroundColor: ['#198754', '#0d6efd', '#ffc107'],
                borderWidth: 0,
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { 
                  position: 'bottom',
                  labels: {
                    padding: 20,
                    usePointStyle: true,
                    font: { size: 12 }
                  }
                },
                tooltip: {
                  backgroundColor: 'rgba(0,0,0,0.8)',
                  titleColor: 'white',
                  bodyColor: 'white',
                  cornerRadius: 8,
                  displayColors: true
                }
            },
            cutout: '60%'
        }
    });

    // Financial Overview Bar Chart
    new Chart(document.getElementById('financialChart'), {
        type: 'bar',
        data: {
            labels: ['Total Rent', 'Collected', 'Outstanding'],
            datasets: [{
                label: 'Amount (R)',
                data: [@Model.TotalMonthlyRent, @Model.CollectedRent, @Model.OutstandingRent],
                backgroundColor: ['#0d6efd', '#198754', '#dc3545'],
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                  backgroundColor: 'rgba(0,0,0,0.8)',
                  titleColor: 'white',
                  bodyColor: 'white',
                  cornerRadius: 8,
                  callbacks: {
                    label: function(context) {
                      return 'R' + context.parsed.y.toLocaleString();
                    }
                  }
                }
            },
            scales: {
                y: { 
                  beginAtZero: true,
                  grid: { color: '#f8f9fa' },
                  ticks: {
                    callback: function(value) {
                      return 'R' + value.toLocaleString();
                    }
                  }
                },
                x: {
                  grid: { display: false }
                }
            }
        }
    });
    
    // Auto-refresh dashboard every 5 minutes
    setInterval(function() {
      if (document.visibilityState === 'visible') {
        window.location.reload();
      }
    }, 300000); // 5 minutes
  </script>
}