@model PropertyManagement.Web.ViewModels.MaintenanceRequestViewModel
@{
  var rooms = ViewBag.Rooms as List<PropertyManagement.Web.ViewModels.RoomViewModel>;
  bool isEdit = Model?.MaintenanceRequestId > 0;
}

<!-- Form Error Display -->
<div id="formErrors" class="alert alert-danger" style="display: none;"></div>
<div id="formSuccess" class="alert alert-success" style="display: none;"></div>

<form id="maintenanceForm" asp-action="CreateOrEdit" method="post" autocomplete="off" class="needs-validation" novalidate>
  @Html.AntiForgeryToken()
  <input asp-for="MaintenanceRequestId" type="hidden" />
  
  <div class="row g-4">
    <!-- Left Column -->
    <div class="col-lg-6">
      <div class="mb-3">
        <label asp-for="RoomId" class="form-label fw-semibold">Room <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-door-closed"></i>
          </span>
          <select asp-for="RoomId" class="form-select" required>
            <option value="">-- Select Room --</option>
            @if (rooms != null)
            {
              @foreach (var room in rooms)
              {
                <option value="@room.RoomId" selected="@(room.RoomId == Model.RoomId ? "selected" : null)">
                  Room @room.Number (@room.Type)
                </option>
              }
            }
          </select>
        </div>
        <div class="invalid-feedback">Please select a room.</div>
      </div>

      <div class="mb-3">
        <label asp-for="Status" class="form-label fw-semibold">Status <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-activity"></i>
          </span>
          <select asp-for="Status" class="form-select" required>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
          </select>
        </div>
        <div class="invalid-feedback">Please select a status.</div>
      </div>

      <div class="mb-3">
        <label asp-for="AssignedTo" class="form-label fw-semibold">Assigned To</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-person-check"></i>
          </span>
          <select asp-for="AssignedTo" class="form-select">
            <option value="">-- Select Assignee --</option>
            <option value="Me">Me</option>
            <option value="Caretaker">Caretaker</option>
            <option value="Manager">Manager</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="col-lg-6">
      <div class="mb-3">
        <label asp-for="Description" class="form-label fw-semibold">Description <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-card-text"></i>
          </span>
          <textarea asp-for="Description" class="form-control" rows="6" required placeholder="Describe the maintenance issue in detail..."></textarea>
        </div>
        <div class="invalid-feedback">Please provide a description.</div>
        <small class="text-muted">Provide detailed description of the maintenance issue</small>
      </div>

      <div class="mb-3">
        <div class="card border-info bg-light">
          <div class="card-body p-3">
            <h6 class="card-title text-info mb-2">
              <i class="bi bi-info-circle"></i> Request Information
            </h6>
            <div id="requestSummary">
              <p class="mb-1"><strong>ID:</strong> <span id="requestIdDisplay">@(isEdit ? Model.MaintenanceRequestId.ToString() : "New Request")</span></p>
              <p class="mb-0"><strong>Action:</strong> <span id="requestAction">@(isEdit ? "Update existing request" : "Create new request")</span></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

<div class="row mt-4">
  <div class="col-12">
    <div class="d-flex justify-content-end gap-2">
      <button type="button" class="btn btn-secondary" onclick="closeMaintenanceModal()">
        <i class="bi bi-x-circle"></i> Cancel
      </button>
      <button type="submit" class="btn btn-primary" form="maintenanceForm">
        <i class="bi bi-tools"></i>
        <span class="submit-text">@(isEdit ? "Update Request" : "Save Request")</span>
        <div class="spinner-border spinner-border-sm ms-2" style="display: none;" role="status" aria-hidden="true"></div>
      </button>
    </div>
  </div>
</div>

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('maintenanceForm') && typeof initializeMaintenanceForm === 'function') {
      initializeMaintenanceForm();
    }
  });
  
  setTimeout(function() {
    if (document.getElementById('maintenanceForm') && typeof initializeMaintenanceForm === 'function') {
      initializeMaintenanceForm();
    }
  }, 100);
</script>