@model PropertyManagement.Web.ViewModels.WaitingListEntryViewModel
@{
  var roomTypeOptions = ViewBag.RoomTypeOptions as List<string>;
  var statusOptions = ViewBag.StatusOptions as List<string>;
  var sourceOptions = ViewBag.SourceOptions as List<string>;
  bool isEdit = Model?.WaitingListId > 0;
}

<!-- Form Error Display -->
<div id="formErrors" class="alert alert-danger" style="display: none;"></div>
<div id="formSuccess" class="alert alert-success" style="display: none;"></div>

<form id="waitingListForm" asp-action="CreateOrEdit" method="post" autocomplete="off" class="needs-validation" novalidate>
  @Html.AntiForgeryToken()
  <input asp-for="WaitingListId" type="hidden" />
  @if (isEdit)
  {
    <input asp-for="RegisteredDate" type="hidden" />
    <input asp-for="NotificationCount" type="hidden" />
    <input asp-for="LastNotified" type="hidden" />
  }
  
  <div class="row">
    <!-- Left Column -->
    <div class="col-lg-6">
      <div class="mb-3">
        <label asp-for="PhoneNumber" class="form-label fw-semibold">Phone Number <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-telephone"></i>
          </span>
          <input asp-for="PhoneNumber"
                 type="tel"
                 class="form-control"
                 placeholder="0821234567"
                 pattern="^0[6-8][0-9]{8}$"
                 title="South African mobile number (e.g., 0821234567)"
                 maxlength="10"
                 required />
        </div>
        <div class="invalid-feedback">Please enter a valid SA mobile number.</div>
        <small class="text-muted">South African mobile format (e.g., 0821234567)</small>
      </div>

      <div class="mb-3">
        <label asp-for="FullName" class="form-label fw-semibold">Full Name</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-person-circle"></i>
          </span>
          <input asp-for="FullName" class="form-control" placeholder="John Doe" />
        </div>
        <small class="text-muted">Optional - can be added later if not provided</small>
      </div>

      <div class="mb-3">
        <label asp-for="Email" class="form-label fw-semibold">Email Address</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-envelope"></i>
          </span>
          <input asp-for="Email" class="form-control" type="email" placeholder="john.doe@example.com" />
        </div>
        <div class="invalid-feedback">Please enter a valid email address.</div>
        <small class="text-muted">Optional - for email notifications</small>
      </div>

      <div class="mb-3">
        <label asp-for="PreferredRoomType" class="form-label fw-semibold">Preferred Room Type</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-door-closed"></i>
          </span>
          <select asp-for="PreferredRoomType" class="form-select">
            @if (roomTypeOptions != null)
            {
              foreach (var option in roomTypeOptions)
              {
                <option value="@option" selected="@(option == Model?.PreferredRoomType)">
                  @(option == "Any" ? "Any Room Type" : $"{option} Room")
                </option>
              }
            }
            else
            {
              <option value="Any">Any Room Type</option>
              <option value="Single">Single Room</option>
              <option value="Double">Double Room</option>
              <option value="Family">Family Room</option>
              <option value="Studio">Studio Apartment</option>
            }
          </select>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="col-lg-6">
      <div class="mb-3">
        <label asp-for="MaxBudget" class="form-label fw-semibold">Maximum Budget</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-currency-dollar"></i>
          </span>
          <span class="input-group-text">R</span>
          <input asp-for="MaxBudget"
                 class="form-control"
                 type="number"
                 placeholder="0.00"
                 step="0.01"
                 min="0" />
        </div>
        <small class="text-muted">Maximum they can afford per month</small>
      </div>

      <div class="mb-3">
        <label asp-for="Status" class="form-label fw-semibold">Status <span class="text-danger">*</span></label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-flag"></i>
          </span>
          <select asp-for="Status" class="form-select" required>
            @if (statusOptions != null)
            {
              foreach (var option in statusOptions)
              {
                <option value="@option" selected="@(option == Model?.Status)">@option</option>
              }
            }
            else
            {
              <option value="Active">Active</option>
              <option value="Contacted">Contacted</option>
              <option value="Converted">Converted</option>
              <option value="Not Interested">Not Interested</option>
              <option value="Inactive">Inactive</option>
            }
          </select>
        </div>
        <div class="invalid-feedback">Please select a status.</div>
      </div>

      @if (!isEdit)
      {
        <div class="mb-3">
          <label class="form-label fw-semibold">Source</label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-signpost"></i>
            </span>
            <select name="Source" class="form-select">
              @if (sourceOptions != null)
              {
                foreach (var option in sourceOptions)
                {
                  <option value="@option">@option</option>
                }
              }
              else
              {
                <option value="Phone">Phone Call</option>
                <option value="Website">Website</option>
                <option value="Referral">Referral</option>
                <option value="Social Media">Social Media</option>
                <option value="Walk-in">Walk-in</option>
                <option value="Other">Other</option>
              }
            </select>
          </div>
          <small class="text-muted">How did they find us?</small>
        </div>
      }

      <div class="mb-3">
        <label asp-for="Notes" class="form-label fw-semibold">Notes</label>
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-journal-text"></i>
          </span>
          <textarea asp-for="Notes" class="form-control" rows="4" 
                   placeholder="Any important details or requirements..."></textarea>
        </div>
        <small class="text-muted">Special requirements, preferences, or other notes</small>
      </div>

      @if (isEdit)
      {
        <!-- Statistics Display for Edit Mode -->
        <div class="mt-3">
          <div class="card bg-light">
            <div class="card-body p-3">
              <h6 class="card-title text-info mb-2">
                <i class="bi bi-info-circle"></i> Entry Statistics
              </h6>
              <div class="row">
                <div class="col-6">
                  <div class="small">
                    <strong>Registered:</strong><br>
                    @Model.RegisteredDateFormatted
                  </div>
                </div>
                <div class="col-6">
                  <div class="small">
                    <strong>Notifications:</strong><br>
                    @Model.NotificationCount sent
                  </div>
                </div>
              </div>
              @if (Model.LastNotified.HasValue)
              {
                <div class="row mt-2">
                  <div class="col-12">
                    <div class="small">
                      <strong>Last Notified:</strong><br>
                      @Model.LastNotifiedFormatted
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</form>

<div class="row mt-4">
  <div class="col-12">
    <div class="d-flex justify-content-end gap-2">
      <button type="button" class="btn btn-secondary" onclick="closeWaitingListModal()">
        <i class="bi bi-x-circle"></i> Cancel
      </button>
      <button type="submit" class="btn btn-primary" form="waitingListForm">
        <i class="bi bi-hourglass-split"></i> 
        <span class="submit-text">@(isEdit ? "Update Entry" : "Add to Waiting List")</span>
        <div class="spinner-border spinner-border-sm ms-2" style="display: none;" role="status" aria-hidden="true"></div>
      </button>
    </div>
  </div>
</div>

<script type="text/javascript">
  // Form initialization will be handled by parent page JavaScript
  document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('waitingListForm') && typeof initializeWaitingListForm === 'function') {
      initializeWaitingListForm();
    }
  });
  
  // Initialize immediately for dynamic content
  setTimeout(function() {
    if (document.getElementById('waitingListForm') && typeof initializeWaitingListForm === 'function') {
      initializeWaitingListForm();
    }
  }, 100);
</script>

<style>
  .form-section-title {
    color: #495057;
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e9ecef;
  }

  .required::after {
    content: " *";
    color: #dc3545;
  }

  .stat-item {
    text-align: center;
  }

  .stat-label {
    font-size: 0.875rem;
    color: #6c757d;
    font-weight: 500;
  }

  .stat-value {
    font-size: 1.1rem;
    font-weight: 600;
    color: #495057;
  }

  .input-group-text {
    background-color: #f8f9fa;
    border-color: #ced4da;
    color: #6c757d;
  }

  .form-control:focus + .input-group-text,
  .form-control:focus {
    border-color: #86b7fe;
    outline: none;
  }

  .form-check-input:checked {
    background-color: #198754;
    border-color: #198754;
  }

  .card.bg-light {
    background-color: #f8f9fa !important;
    border: 1px solid #e9ecef;
  }

  .form-control, .form-select {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 0.75rem;
    transition: border-color 0.15s ease-in-out;
  }

  .input-group {
    border-radius: 8px;
    overflow: hidden;
  }

  .btn {
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-weight: 500;
  }

  .btn-primary {
    background: linear-gradient(135deg, #0d6efd 0%, #0a58ca 100%);
  }

  .btn-secondary {
    background: #6c757d;
  }
</style>